Feature: パフォーマンス

    Scenario: レスポンスタイム
        When ユーザがシステムにアクセスする。
        Then 各ページの 最大レスポンスタイム"t_res" が以下の基準を満たすこと。
            | ページ種類         | t_res[ms] |
            | ===============    | ========= |
            | トップページ       | 2000      |
            | 検索結果ページ     | 3000      |
            | 商品詳細ページ     | 2000      |
            | ユーザプロフィール | 2000      |

    Scenario: 同時接続数
        Given システムが高負荷状態にある。
        When 同時に複数のユーザがアクセスする。
        Then システムは最低でも1000人の同時接続を処理できること。

    Scenario: 可用性 (SLA目標)
        Given システムが稼働中である。
        When 一定期間内の稼働時間を測定する。
        Then システムの可用性が99.9%以上であること。

    Scenario: 可用性 (ダウンタイム許容)
        Given システムが稼働中である。
        When 一定期間内のダウンタイムを測定する。
        Then システムのダウンタイムが月間43.2分以下であること。

    Scenario: 可用性 (冗長構成要件)
        Given システムが冗長構成で設計されている。
        When 主要コンポーネントが障害を起こした場合。
        Then システムは自動的にフェイルオーバーし、サービスを継続できること。

    Scenario: スケーラビリティ (垂直／水平スケール方針)
        Given システムがスケーラビリティを考慮して設計されている。
        When ユーザ数やトラフィックが増加する場合。
        Then システムは垂直スケーリングおよび水平スケーリングの両方に対応できること。

    Scenario: スケーラビリティ (セッション管理(ステートレス化))
        Given システムが複数のサーバで構成されている。
        When ユーザが異なるサーバにアクセスする場合。
        Then ユーザセッションは一貫して管理され、ステートレス化が実現されていること。

    Scenario: スケーラビリティ (セキュリティ)
            | 項目               | 内容                                       |
            | ====               | ====                                       |
            | https対応          | 全ての通信はHTTPSで暗号化されていること    |
            | 認証強化           | 多要素認証(MFA)をサポートすること          |
            | CSRF/XSS対策       | 適切なセキュリティ対策が実装されていること |
            | 脆弱性スキャン     | 定期的に脆弱性スキャンを実施すること       |
            | パスワードポリシー | 強力なパスワードポリシーを適用すること     |

    Scenario: データ保全／バックアップ
            | 項目                   | 内容                       |
            | ====                   | ====                       |
            | バックアップ頻度       | 1日1回以上                 |
            | 保持期間               | 最低30日間                 |
            | 復旧手順               | 明確に文書化されていること |
            | 復旧時間目標 (RTO)     | 4時間以内                  |
            | 復旧ポイント目標 (RPO) | 1時間以内                  |

    Scenario: ログと監視
            | 項目           | 内容                                       |
            | ====           | ====                                       |
            | アクセスログ   | 全てのユーザアクセスを記録すること         |
            | アプリログ     | システムエラーや例外を詳細に記録すること   |
            | エラー監視     | リアルタイムでエラーを監視し、通知すること |
            | メトリクス収集 | パフォーマンス指標を定期的に収集すること   |

    Scenario: 運用
            | 項目         | 内容                       |
            | ====         | ====                       |
            | デプロイ手順 | 自動化されていること       |
            | 環境構成     | コード化されていること     |
            | 障害対応手順 | 明確に文書化されていること |
            | 定期メンテ   | 定期的に実施されていること |

    Scenario: 国際化／ローカライズ (I18N/L10N)
            | 項目           | 内容                               |
            | ====           | ====                               |
            | 多言語対応     | 日本語および英語に対応していること |
            | 日付／通貨形式 | ローカル形式で表示されること       |

    Scenario: 可用性／耐障害性
            | 項目                   | 内容                                                     |
            | ====                   | ====                                                     |
            | DR設計                 | 災害復旧計画が策定されていること                         |
            | RPO/RTO目標            | データ復旧とシステム復旧の目標が設定されていること       |
            | 障害検知               | 障害を迅速に検知する仕組みがあること                     |
            | 自動復旧               | 障害発生時に自動的に復旧する仕組みがあること             |
            | 冗長化                 | 主要コンポーネントが冗長化されていること                 |
            | 定期テスト             | DR計画が定期的にテストされていること                     |
            | 監査ログ               | 障害対応の履歴が記録されていること                       |
            | 教育訓練               | 運用チームがDR手順を理解していること                     |
            | 外部委託               | DR計画が外部ベンダーと連携していること                   |
            | SLA連携                | サービスレベルアグリーメントにDR要件が含まれていること   |
            | 継続的改善             | DR計画が継続的に見直され、改善されていること             |
            | 法令遵守               | 関連する法規制に準拠していること                         |
            | コミュニケーション     | 災害発生時の連絡体制が確立されていること                 |
            | 代替サイト             | 主要サービスの代替サイトが用意されていること             |
            | データバックアップ     | 定期的なデータバックアップが実施されていること           |
            | リスク評価             | 定期的にリスク評価が実施されていること                   |
            | ベンダー管理           | 主要ベンダーがDR計画に組み込まれていること               |
            | 定期レビュー           | DR計画が定期的にレビューされていること                   |
            | インシデント対応       | インシデント対応手順がDR計画に含まれていること           |
            | ドキュメント管理       | DR計画が適切に文書化され、アクセス可能であること         |
            | 監査対応               | DR計画が外部および内部監査に対応していること             |
            | リソース確保           | DR計画に必要なリソースが確保されていること               |
            | トレーニングプログラム | 運用チーム向けの定期的なトレーニングが実施されていること |
            | モニタリング           | システムの状態が継続的にモニタリングされていること       |

    Scenario: 法令遵守
            | 項目           | 内容                                             |
            | ====           | ====                                             |
            | 個人情報保護   | 個人情報保護法に準拠していること                 |
            | GDPR対応       | 欧州連合のGDPRに準拠していること                 |
            | その他規制     | 関連する業界規制に準拠していること               |
            | ログ保管ルール | ログの保管期間と管理方法が法令に準拠していること |

    Scenario: データ要件／データモデル
        * 主要エンティティ一覧
            | エンティティ名 | 説明                           | 主な属性                       |
            | ============== | ============================== | =============================  |
            | ユーザ         | システムの利用者               | ユーザID、名前、メールアドレス |
            | 商品           | 出品される商品                 | 商品ID、名称、価格、説明       |
            | 注文           | ユーザが行う購入               | 注文ID、ユーザID、商品ID、数量 |
            | カテゴリ       | 商品の分類                     | カテゴリID、名称               |
            | レビュー       | 商品に対するユーザの評価       | レビューID、商品ID、評価点数   |

    Scenario: API要件
        * API一覧
            | API名               | 説明                           | エンドポイント              | メソッド |
            | =================== | ============================== | =========================== | ======== |
            | ユーザ登録API       | 新規ユーザを登録する           | /api/users/register         | POST     |
            | 商品一覧取得API     | 商品の一覧を取得する           | /api/products               | GET      |
            | 注文作成API         | 新規注文を作成する             | /api/orders                 | POST     |
            | レビュー投稿API     | 商品に対するレビューを投稿する | /api/reviews                | POST     |
            | カテゴリ一覧取得API | 商品カテゴリの一覧を取得する   | /api/categories             | GET      |
        * 認証方式 (Token/JWT)
            | API名               | 認証方式  |
            | =================== | ========= |
            | ユーザ登録API       | なし      |
            | 商品一覧取得API     | Token     |
            | 注文作成API         | JWT       |
            | レビュー投稿API     | JWT       |
            | カテゴリ一覧取得API | Token     |
        * 主要エンドポイント一覧
            | エンドポイント         | 説明                             | メソッド |
            | ====================== | ================================ | ======== |
            | /api/users/register    | 新規ユーザ登録                   | POST     |
            | /api/products          | 商品一覧取得                     | GET      |
            | /api/orders            | 注文作成                         | POST     |
            | /api/reviews           | レビュー投稿                     | POST     |
            | /api/categories        | カテゴリ一覧取得                 | GET      |

    Scenario: インテグレーション要件
            | システム名           | 連携内容                         | 連携方法          |
            | ===============      | ================================ | ================= |
            | メールサービス       | Mailgun/SES                      | SMTP, REST API    |
            | S3/ストレージ        | ファイル保存および取得           | REST API          |
            | 決済                 | クレジットカード決済処理         | REST API          |
            | 外部認証             | ユーザ認証および認可処理         | OAuth2.0/JWT      |
            | 外部フォーラム       | Discourseなど                    | REST API          |
            | 分析プラットフォーム | Google Analytics等               | REST API          |
            | SMSサービス          | Twilio等                         | REST API          |
            | 通知サービス         | プッシュ通知およびメール通知     | REST API          |

    Scenario: インフラ／アーキテクチャ設計
            | 項目                    | 内容                                 |
            | ======================= | ============================         |
            | WEBサーバ               | nginx + gunicorn/uwsgi               |
            | アプリサーバ            | Djangoフレームワーク                 |
            | データベース            | PostgreSQL                           |
            | キャッシュ              | Redis                                |
            | タスクキュー            | Celery                               |
            | ストレージ              | S3互換ストレージ                     |
            | ネットワーク            | VPC設計                              |
            | TLS                     | Let's Encrypt                        |
            | ファイアウォール        | 適切なルール設定                     |
            | 静的ファイル配信        | CDN利用                              |
            | ======================= | ============================         |
            | コンテナ／仮想化        | Docker                               |
            | CI/CD                   | GitHub Actions/Jenkins               |
            | モニタリング            | Prometheus + Grafana                 |
            | ロードバランサ          | ELB/Nginx                            |
            | バックアップ            | 定期的なバックアップと復旧手順の確立 |
            | セキュリティ            | WAF/IDS/IPSなど                      |
            | スケーリング            | オートスケーリングの設定             |
            | ネットワーク設計        | VPC/Subnet/Firewallルールの設計      |

    Scenario: デプロイ、CI/CD
        * ビルド、テスト、デプロイのフローは、以下の通りとする。
            | ステップ       | 内容                                   |
            | =============  | ================================       |
            | コードプッシュ | 開発者がコードをリポジトリにプッシュ   |
            | ビルド         | 自動ビルドプロセスが開始される         |
            | ユニットテスト | 自動ユニットテストが実行される         |
            | 統合テスト     | 自動統合テストが実行される             |
            | デプロイ       | テスト成功後、自動デプロイが実行される |
            | 通知           | デプロイ結果がチームに通知される       |
        * ブランチ戦略は、以下の通りとする。
            | ブランチ名  | 用途                           |
            | =========== | ============================== |
            | main/master | 本番環境用の安定版コード       |
            | develop     | 開発中の最新コード             |
            | feature/*   | 新機能開発用の個別ブランチ     |
            | hotfix/*    | 本番環境の緊急修正用ブランチ   |

    Scenario: テスト要件
        * 単体テストの要件は、以下の通り。
            | 項目                 | 内容                           |
            | =================    | ============================== |
            | カバレッジ目標       | 80%以上                        |
            | テストフレームワーク | pytest                         |
            | 自動化               | CI/CDパイプラインで自動実行    |
        * 結合テストの要件は、以下の通り。
            | 項目                 | 内容                           |
            | =================    | ============================== |
            | カバレッジ目標       | 70%以上                        |
            | テストフレームワーク | pytest + Playwright            |
            | 自動化               | CI/CDパイプラインで自動実行    |
        * システムテストの要件は、以下の通り。
            | 項目                 | 内容                           |
            | =================    | ============================== |
            | カバレッジ目標       | 60%以上                        |
            | テストフレームワーク | playwright + pytest            |
            | 自動化               | CI/CDパイプラインで自動実行    |
        * パフォーマンステストの要件は、以下の通り。
            | 項目              | 内容                           |
            | ================= | ============================== |
            | ツール            | JMeter                         |
            | シナリオ          | 主要なユーザ操作をシミュレート |
            | レスポンスタイム  | 95パーセンタイルで2秒以下      |
            | 同時接続数        | 最大1000ユーザ                 |
            | 自動化            | CI/CDパイプラインで自動実行    |
        * セキュリティテストの要件は、以下の通り。
            | 項目              | 内容                           |
            | ================= | ============================== |
            | ツール            | OWASP ZAP                      |
            | スキャン頻度      | 月1回以上                      |
            | 脆弱性対応        | 発見次第、速やかに対応         |
            | 自動化            | CI/CDパイプラインで自動実行    |

    Scenario: アクセシビリティ・UX要件
        * レスポンシブ設計は、以下の通りとする。
            | デバイス種類   | 画面サイズ(px)       |
            | =============  | ==================== |
            | スマートフォン | 1136×640             |
            | タブレット     | 2000×1200            |
            | デスクトップ   | 1366×768             |
        * モバイル優先は、以下の通りとする。
            | 項目                 | 内容                           |
            | =================    | ============================== |
            | タッチ操作最適化     | タッチターゲットのサイズ確保   |
            | パフォーマンス最適化 | 画像圧縮、遅延読み込みの実装   |
            | ナビゲーション簡素化 | シンプルなメニュー構造         |
        * アクセシビリティ基準 (WCAG) は、以下の通りとする。
            | レベル       | 内容                                 |
            | ============ | ================================     |
            | レベルA      | 基本的なアクセシビリティ要件を満たす |
            | レベルAA     | 中程度のアクセシビリティ要件を満たす |
            | レベルAAA    | 高度なアクセシビリティ要件を満たす   |

    Scenario: 運用・保守
        * 定期メンテナンスは、以下の通りとする。
            | 項目              | 内容                           |
            | ================= | ============================== |
            | メンテナンス頻度  | 月1回以上                      |
            | 作業内容          | バックアップ、ログ確認、更新   |
            | 通知方法          | メールおよびシステム内通知     |
        * バージョン管理は、以下の通りとする。
            | 項目                 | 内容                           |
            | =================    | ============================== |
            | バージョン管理ツール | Git                            |
            | ブランチ戦略         | Git FlowまたはGitHub Flow      |
            | リリースノート       | 変更点を明確に記載             |
        * 依存性更新は、以下の通りとする。
            | 項目              | 内容                           |
            | ================= | ============================== |
            | 更新頻度          | 月1回以上                      |
            | ツール            | Dependabot、Renovate           |
            | テスト            | 依存性更新後の自動テスト実行   |
        * 障害対応は、以下の通りとする。
            | 項目              | 内容                             |
            | ================= | ==============================   |
            | 障害検知          | 監視ツールによるリアルタイム検知 |
            | 通知方法          | SMSおよびメール通知              |
            | 対応手順          | 障害対応マニュアルに従う         |
        * サポート窓口は、以下の通りとする。
            | 項目              | 内容                           |
            | ================= | ============================== |
            | サポートチャネル  | メール、チャット、電話         |
            | 対応時間          | 平日9:00～18:00                |
            | SLA               | 初回対応までの時間を定義       |

    Scenario: 移行／導入計画
        * 初期データ投入は、以下の通りとする。
            | 項目               | 内容                           |
            | =================  | ============================== |
            | データ形式         | CSV、JSON                      |
            | データクレンジング | 不要データの削除、整合性確認   |
            | バリデーション     | データ品質チェック             |
        * ユーザ移行は、以下の通りとする。
            | 項目              | 内容                           |
            | ================= | ============================== |
            | 移行方法          | バッチ処理、API連携            |
            | 移行スケジュール  | 夜間または週末に実施           |
            | 移行検証          | 移行後のデータ整合性確認       |
        * ローンチのフェーズは、以下の通りとする。
            | フェーズ          | 内容                           |
            | ================= | ============================== |
            | パイロット        | 限定ユーザでの試験運用         |
            | 段階的展開        | ユーザグループごとに展開       |
            | 全面展開          | 全ユーザへのサービス提供開始   |
        * リリース計画は、以下の通りとする。
            | 項目              | 内容                           |
            | ================= | ============================== |
            | リリース日        | 事前に通知された日付           |
            | リリース手順      | 明確に文書化された手順         |
            | ロールバック計画  | 問題発生時の復旧手順           |

    Scenario: リスクと対応策
        * 主要リスク (スパム、決済リスク、法的リスク)と予防／対応策は、以下の通り。
            | リスク種類    | 説明                               | 予防策／対応策                           |
            | ============= | ================================   | =======================================  |
            | スパム        | 不正なコンテンツやアカウントの作成 | CAPTCHA導入、コンテンツフィルタリング    |
            | 決済リスク    | 不正取引やチャージバックの発生     | 決済ゲートウェイのセキュリティ強化       |
            | 法的リスク    | 規制違反や訴訟リスク               | 法務チームとの連携、コンプライアンス遵守 |